## Reference URL

https://zenn.dev/layerx/articles/028cb518cffd61
https://nhost.io/blog/how-to-use-graphql-code-generator-with-react-and-apollo
https://zenn.dev/optimisuke/articles/8de632308cebeb
https://zenn.dev/sky/articles/47b86d3387389d
https://zenn.dev/buyselltech/articles/b64935ea7d6fee

## Stpe

1. install packages
2. generate graphql-codegen config.ts file
3. set AppolloProvider to frontend
4. generate `xxx.graphql` file
5. use `useQuery`, `useMutation` etc


## 1. Install packages

```bash
npm i -D typescript ts-node @graphql-codegen/cli @graphql-codegen/client-preset
```

## 2. codegen config.ts

```ts:tools/graphql-codegen/codegen.ts
import type { CodegenConfig } from '@graphql-codegen/cli';

const codegenConfig: CodegenConfig = {
  overwrite: true,
  schema: 'dist/apps/api/autogenerated-schema.gql',
  documents: ['apps/web/**/*.graphql', 'libs/**/*.graphql'],
  generates: {
    'libs/web/data-access-graphql/src/lib/__generated__/': {
      preset: 'client',
      plugins: [
        {
          // branded type for custom Scalar
          add: {
            content: `export type DateString = string & { readonly __brand: unique symbol }`
          }
        }
      ],
      config: {
        strictScalars: true,
        useTypeImports: true,
        skipTypename: true,
        arrayInputCoercion: true,
        avoidOptionals: {
          field: true,
          inputValue: false,
          object: true,
          defaultValue: false
        },
        scalars: {
          Date: 'DateString'
        },
        enumsAsTypes: true
      }
    }
  }
};

export default codegenConfig;
```

## 3. Set ApolloProvider

1. generate apolloClient

```ts:apps/web/lib/apollo-client.ts
import { NEXT_PUBLIC_API_GQL_URL } from '@/config/index';
import { ApolloClient, InMemoryCache } from '@apollo/client';

// If env.NEXT_PUBLIC_API_GQL_URL is undefined, throw exeption.
if (!NEXT_PUBLIC_API_GQL_URL) {
  throw new Error('NEXT_PUBLIC_API_GQL_URL is undefined');
}

export const apolloClient = new ApolloClient({
  uri: NEXT_PUBLIC_API_GQL_URL,
  cache: new InMemoryCache(),
  credentials: 'include'
});
```

2. generate ApolloProvider

```tsx:apps/web/components/providers/ApolloProvider.tsx
'use client';

import { apolloClient } from '@/lib/apollo-client';
import { ApolloProvider as Apollo } from '@apollo/client';

const ApolloProvider = ({ children }: React.PropsWithChildren) => {
  return <Apollo client={apolloClient}>{children}</Apollo>;
};

export default ApolloProvider;
```

3. set ApolloProvier

```tsx:apps/web/app/layout.tsx
import ApolloProvider from '@/components/providers/ApolloProvider';
...

export default async function RootLayout({ children }: { children: ReactNode }) {
  return (
    <html suppressHydrationWarning>
      <head>
        ...
      </head>

      <body className="overflow-x-hidden bg-white text-black antialiased dark:bg-gray-900 dark:text-white">
        <ApolloProvider>
          ...
        </ApolloProvider>
      </body>
    </html>
  );
}
```