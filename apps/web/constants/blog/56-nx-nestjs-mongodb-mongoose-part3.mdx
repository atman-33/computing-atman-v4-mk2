---
title: Setting Up Nx Nestjs Mongodb Mongoose Integration - Part 3
date: '2023-11-19'
lastmod: '2023-11-19'
tags: ['nx', 'nest js', 'mongodb', 'mongoose', 'next js']
images: ['/static/images/common/mongodb.png']
summary: In Part 3 of our Nx Nest.js GraphQL Integration series, we install crucial packages, update configuration files, and generate a GraphQL client. This tutorial guides you through the steps to seamlessly integrate GraphQL into your project, enhancing data management and scalability. Congratulations on completing this comprehensive guide to a harmonious Nx, Nest.js, and GraphQL integration! Stay tuned for more enriching tutorials. Happy coding!
---

## Introduction

Welcome to the third part of our Nx Nest.js GraphQL Integration series, where we enhance our project by incorporating GraphQL. Follow these steps to seamlessly install essential packages, update the `app.module.ts` file, generate the `data-access-graphql` project, and utilize GraphQL code generation. We'll guide you through creating a GraphQL client and demonstrate its usage in a Next.js web application.

## Reference URL

[Engilaboo Next.js GraphQL Tutorial](https://www.engilaboo.com/nextjs-graphql/)

## Install Packages

```bash
npm i @graphql-codegen/typed-document-node @graphql-codegen/cli @graphql-codegen/typescript-operations @apollo/client
```

## Update app.module.ts in Nest.js Project

Add the following code:

```typescript
@Module({
  imports: [
    ServeStaticModule.forRoot({
      rootPath: join(__dirname, '..', 'web/.next'),
      exclude: ['/api/*', '/api/graphql']
    }),
    GraphQLModule.forRoot<ApolloDriverConfig>({
      driver: ApolloDriver,
      path: '/api/graphql',
      autoSchemaFile: path.join(__dirname, './autogenerated-schema.gql')
    }),
```

By doing so, the `autogenerated-schema.gql` is created in the `dist/apps/api` folder after building the API.

## Generate data-access-graphql Project

```bash
npx nx generate @nx/js:library data-access-graphql --directory=libs/web/data-access-graphql --importPath=@libs/web/data-access-graphql --tags=scope:web --bundler=swc

✔ Which unit test runner would you like to use? · none
```

## Create codegen.yml

`tools/graphql-codegen/codegen.yml`

```yaml
overwrite: true
schema: 'dist/apps/api/autogenerated-schema.gql'

documents:
  - 'apps/web/**/*.graphql'
  - 'libs/**/*.graphql'

generates:
  libs/web/data-access-graphql/src/lib/graphql.gen.ts:
    plugins:
      - 'typescript'
      - 'typescript-operations'
      - 'typed-document-node'
    config:
      avoidOptionals:
        object: true
        field: true
```

## Run Codegen

Add script to package.json

```json
   "scripts": {
    "start:gql:watch": "graphql-codegen --config tools/graphql-codegen/codegen.yml --watch",
 ```

## Create graphql-client.ts

`libs/web/data-access-graphql/src/lib/graphql-client.ts`

```typescript
import { ApolloClient, InMemoryCache } from '@apollo/client';

export const getGraphqlClient = (url: string) => {
  const client = new ApolloClient({
    uri: url,
    cache: new InMemoryCache()
  });

  return client;
};

```

## Update index.ts

Fix export.

`libs/web/data-access-graphql/src/index.ts`

```typescript
export * from './lib/graphql-client';
export * from './lib/graphql.gen';
```

## Create Client for Web

`apps/web/data-access/graphql-client.ts`

> In this case, `apps/web` is a Next.js project.

```typescript
// eslint-disable-next-line @nx/enforce-module-boundaries
import { NEXT_PUBLIC_API_GQL_URL } from '@/config/index';
import { getGraphqlClient } from '@libs/web/data-access-graphql';

// If env.NEXT_PUBLIC_API_GQL_URL is undefined, throw an exception.
if (!NEXT_PUBLIC_API_GQL_URL) {
  throw new Error('NEXT_PUBLIC_API_GQL_URL is undefined');
}

export const gql = getGraphqlClient(NEXT_PUBLIC_API_GQL_URL);

```

Update `tsconfig.base.json`

```json
    "paths": {
      "@/lib/*": [
        "apps/web/lib/*"
      ],
```

## Use graphql-client

Example:

```tsx
import { gql } from '@/lib/graphql-client';
import { GetSampleTodosDocument } from '@libs/web/data-access-graphql';

export default async function page() {
  const data = (
    await gql.query({
      query: GetSampleTodosDocument
    })
  ).data;

  console.log(data);

  return <div>{data.GetSampleTodosDocument.map((x) => x._id)}</div>;
}
```

Congratulations! You've successfully configured Nx, Nest.js, and GraphQL in a harmonious integration. This series has empowered you to efficiently manage and query data, making your application more robust and scalable. Stay tuned for more insightful tutorials and happy coding!

The first part is here.

[Setting Up Nx Nestjs Mongodb Mongoose Integration - Part 1](/blog/54-nx-nestjs-mongodb-mongoose-part1/)